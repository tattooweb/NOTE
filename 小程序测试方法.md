# 小程序测试方法

1. **反编译获取源码，代码审计**

小程序wxapkg包可分为 主包 和 若干个子包

一般情况下，主包占用少，子包大

存放于`/data/data/com.tencent.mm/Micromsg/a6df45df5as4d3as4/appbrand/pkg/某几个.wxapkg`

获取wxapkg包后：

- 对于主包：`node wuWxapkg.js 主包.wxapkg`
- 对于子包：`node wuWxapkg.js 子包.wxapkg -s=指定主包路径`

2. **寻找加密方式**

找到前端源码中的加解密的方法

全局搜索**encrypt、decrypt、AES、DES、RSA**这些关键词，加密的数据包解密后一般漏洞较多

3. **常见漏洞**

- 流程验证漏洞

挖掘方法：

（1）在验证下一步的时候，抓包，查看返回包里面的响应码，尝试修改响应码，进行绕过

（2）输入验证码进入下一步时，先输入正确的验证码，查看正确的返回包，然后随便输入一个验证码，修改返回包中的状态码为正确通过时的状态，查看是否能绕过

- **任意文件上传漏洞**

挖掘方法：

（1）任意上传图片的地方，通过burp修改文件后缀，绕过

（2）上传身份证的地方，如果是摄像头拍照那种，可以结合流程验证绕过漏洞，通过修改返回包中的状态进行绕过

- **Cors跨域访问漏洞**

挖掘方法：

（1）查看请求包中的是否含有origin字段，修改oringin字段，然后查看返回包中的**Access-Control-Allow-Origin**是否改变

（2）也可以使用burp自带的扫描来判断

- **信息泄漏漏洞**

挖掘方法：

（1）获取信息的地方，通过返回包内容来判断是否获取其他用户的信息

- **越权漏洞（平行越权）**

挖掘方法：

（1）增删改查处，多注意数据包中的字段，挖掘越权漏洞，一定要细心细心再细心

（2）可以通过遍历字段的方法，来测试是否越权

- **硬核漏洞（不安全的HTTP方法）**

挖掘方法：

（1）把POST请求改成OPTIONS，然后查看返回包中的**Access-Control-Allow-Methods**值

